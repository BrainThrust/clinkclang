import { Agent } from "@/agent-core/core";
import { Summary } from "autoevals";

const OPENAI_API_KEY = "openai_api_key";

async function runSummaryTest() {
  try {
    const agent = new Agent({
      providerName: "openai",
      modelName: "gpt-4o",
      apiKey: OPENAI_API_KEY,
    });

    // input text for summarization (generated by GPT-4o mini)
    const inputText = `
      The internet began as ARPANET in the late 1960s, a project funded by the U.S. Department of Defense. 
      Its original purpose was to create a network that could maintain communication even if parts of it failed. 
      Over the decades, the internet evolved from a military project to a global network connecting billions of devices. 
      Key milestones include the invention of the World Wide Web in 1989 by Tim Berners-Lee, 
      the popularization of browsers like Mosaic in the 1990s, 
      and the rise of mobile internet access in the 2000s. 
      Today, the internet is integral to modern society, powering communication, commerce, and information sharing.
    `;

    // expected summary
    const expectedSummary = `
      The internet originated as ARPANET in the 1960s, evolving into a global network. 
      Key developments include the World Wide Web and mobile access, making it essential for modern society.
    `;

    // generating summary
    const prompt = `Summarize the following text in 3 sentences:\n\n${inputText}`;
    const output = await agent.generate(prompt);

    const result = await Summary({
      input: inputText,
      output,
      expected: expectedSummary,
      openAiApiKey: OPENAI_API_KEY
    });

    console.log(`Input Text: ${inputText}`);
    console.log(`Agent Output: ${output}`);
    console.log(`Expected Summary: ${expectedSummary}`);
    console.log(`Summary Score: ${result.score}`);
    console.log(`Rationale: ${result.metadata?.rationale}`);
  } catch (error) {
    console.error("Summary Test Error:", error);
  }
}

runSummaryTest();